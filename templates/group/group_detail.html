{% extends 'group/group_base.html' %}
{% load staticfiles %}
{% block group_css %}
    <link rel="stylesheet" href="{% static 'css/group_detail.css' %}">
{% endblock %}
{% block group_content %}
<h1>group_detail</h1>
    {{ group.group_name }} <br/>
    {{ group.group_status }} <br/>
    {{ group.meeting_time }} <br/>
    {{ group.meeting_place }} <br/>
    {{ group.description }} <br/>
    {{ group.contact }} <br/>
    {{ group.apply_start }} <br/>
    {{ group.apply_end }} <br/>
    {{ group.max_member }} <br/>

    <h3>함께하는 사람들</h3>
    <div class="joined_wrapper">
        {% for member in joined_list %}
            <span>{{ member }}</span>
        {% endfor %}
    </div>

    <h3>참여대기</h3>
    <div class="waiting_wrapper">
        {% for member in applied_list %}
            <span>{{ member }}  </span>
        {% endfor %}
    </div>



    <hr><br/>
    <form action="/group/{{ group.id }}/" method="POST">{% csrf_token %}
        <input type="hidden" value="{{ group.id }}" name="group_id"/>
        <button type="submit">참가신청하기</button>
    </form>
    <hr><br/>
    <form id="comment_form" action="/group/{{ group.id }}/" method="POST">{% csrf_token %}
        {{ comment_form.as_p }}
{#        <input type="text" name="content"/>#}
        <button type="submit">입력</button>
    </form>
    <h1>
        {{ added_comment }}
    </h1>
    <div class="comments_wrapper">
        {% for comment in comments %}
            <div class="comment_wrapper">
                {{ comment.user }} | {{ comment.content }} | {{ comment.created_at }}
            </div>
        {% endfor %}
    </div>
{% endblock %}

{% block js %}
    <script>
    $(document).ready(function() {
        $('#comment_form').submit(function() { // catch the form's submit event
            $.ajax({ // create an AJAX call...
                method: 'POST',
                data: {csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val(),
                comment_content: $(this).find('input[type=text]').val()},
                dataType: "json",
                url: $(this).attr('action'), // the file to call
                success: function(response) { // on success..
                    $('.comments_wrapper').append('<div class="comment_wrapper">'+
                        response["comment_user"] + ' | ' + response["added_comment"] + ' | ' + response["comment_created"]+'</div>');
                }
            });
            return false;
        });
    });
    
    $(document).ready(function() {
        if('{{ message }}'!=""){
            alert('{{ message }}');
        }
    })
    </script>
{% endblock %}